---
import { ui, defaultLang } from '../i18n/ui';

const currentLocale = Astro.currentLocale || defaultLang;
const t = ui[currentLocale as keyof typeof ui];
const isRtl = currentLocale === 'ar';

// Define icons first to map them easily
const icons = [
  // 0: Catering (Food/Utensils)
  `<svg xmlns="http://www.w3.org/2000/svg" class="w-full h-full" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z" /></svg>`,
  
  // 1: Contracting (Building/Construction)
  `<svg xmlns="http://www.w3.org/2000/svg" class="w-full h-full" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4" /></svg>`,

  // 2: Management (Gears/Settings)
  `<svg xmlns="http://www.w3.org/2000/svg" class="w-full h-full" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" /><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" /></svg>`,
  
  // 3: Logistics (Truck/Transport)
  `<svg xmlns="http://www.w3.org/2000/svg" class="w-full h-full" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path d="M9 17a2 2 0 11-4 0 2 2 0 014 0zM19 17a2 2 0 11-4 0 2 2 0 014 0z" /><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M13 16V6a1 1 0 00-1-1H4a1 1 0 00-1 1v10a1 1 0 001 1h1m8-1a1 1 0 01-1 1H9m4-1V8a1 1 0 011-1h2.586a1 1 0 01.707.293l3.414 3.414a1 1 0 01.293.707V16a1 1 0 01-1 1h-1m-6-1a1 1 0 001 1h1M5 17a2 2 0 104 0m-4 0a2 2 0 114 0m6 0a2 2 0 104 0m-4 0a2 2 0 114 0" /></svg>`,
  
  // 4: Consulting (Lightbulb/Ideas)
  `<svg xmlns="http://www.w3.org/2000/svg" class="w-full h-full" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z" /></svg>`,
];

const services = [
  { titleKey: 'services.catering.title', descKey: 'services.catering.desc', iconIndex: 0 },
  { titleKey: 'services.contracting.title', descKey: 'services.contracting.desc', iconIndex: 1 },
  { titleKey: 'services.management.title', descKey: 'services.management.desc', iconIndex: 2 },
  { titleKey: 'services.logistics.title', descKey: 'services.logistics.desc', iconIndex: 3 },
  { titleKey: 'services.consulting.title', descKey: 'services.consulting.desc', iconIndex: 4 },
];
---

<section id="services" class="mt-20 scroll-mt-28">
  <div class="container mx-auto px-4">
    <div class="text-center mb-16" data-aos="fade-up">
      <h2 class="text-3xl md:text-4xl font-bold text-white mb-4">{t['services.title']}</h2>
      <div class="h-1 w-24 bg-gold mx-auto rounded-full"></div>
    </div>

    <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6 justify-center">
      {services.map((service, index) => {
        // Alternating styles
        const isEven = index % 2 === 0;
        const accentColor = 'text-gold';
        
        return (
          <div
            data-aos="fade-up"
            data-aos-delay={index * 100}
            class="group h-80 perspective-1000"
            role="article"
            aria-labelledby={`service-title-${index}`}
            x-data="{ flipped: false }"
            @mouseenter="flipped = true"
            @mouseleave="flipped = false"
            @click="flipped = !flipped"
          >
            <div 
              class="relative w-full h-full transition-all duration-700 transform-style-3d cursor-pointer shadow-xl rounded-2xl"
              :class="flipped ? 'rotate-y-180' : ''"
            >
              
              {/* Front Face - Icon & Title */}
              <div class="absolute inset-0 w-full h-full backface-hidden bg-black/30 backdrop-blur-xl rounded-2xl border border-white/10 z-10 transform-style-3d overflow-hidden">
                {/* Diagonal Stripes Pattern */}
                <div class="absolute inset-0 opacity-[0.03]" style="background-image: repeating-linear-gradient(45deg, #fff 0, #fff 1px, transparent 0, transparent 50%); background-size: 10px 10px;"></div>
                
                <div class="w-full h-full flex flex-col justify-between p-8 parallax-content relative z-20">
                  {/* Top: Title */}
                  <div class="w-full flex flex-col items-start">
                    <div class={`h-1.5 w-12 mb-6 rounded-full bg-gradient-to-r ${isEven ? 'from-primary to-primary/60' : 'from-secondary to-secondary/60'}`}></div>
                    <h3 
                      id={`service-title-${index}`} 
                      class="text-3xl font-bold text-white text-start leading-tight"
                    >
                      {t[service.titleKey as keyof typeof t]}
                    </h3>
                  </div>

                  {/* Bottom: Icon */}
                  <div class="w-full flex justify-start items-end">
                    <div class={`w-20 h-20 rounded-2xl flex items-center justify-center bg-white/5 border border-white/10 ${accentColor} text-white backdrop-blur-sm shadow-lg group-hover:scale-110 transition-transform duration-500`}>
                      <div class="w-10 h-10">
                        <Fragment set:html={icons[service.iconIndex]} />
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              {/* Back Face - Description */}
              <div class="absolute inset-0 w-full h-full backface-hidden rotate-y-180 bg-gradient-to-br from-black/80 to-black/60 backdrop-blur-xl rounded-2xl border border-white/20 z-20 transform-style-3d">
                <div class="w-full h-full flex flex-col items-center justify-center p-8 text-center parallax-content">
                  <div class={`h-full w-1 absolute top-0 right-0 bg-gradient-to-b ${isEven ? 'from-primary to-primary/60' : 'from-secondary to-secondary/60'}`}></div>
                  
                  <h3 class="text-xl font-bold text-gold mb-4 opacity-90">
                    {t[service.titleKey as keyof typeof t]}
                  </h3>

                  <p class="text-white text-base leading-relaxed mb-6">
                    {t[service.descKey as keyof typeof t]}
                  </p>

                  <a 
                     href="#contact" 
                     class={`inline-flex items-center justify-center px-6 py-2 rounded-full text-sm font-medium transition-all duration-300 ease-in-out
                       bg-white/10 border border-white/20 text-white
                       ${isEven ? 'hover:bg-primary hover:border-primary' : 'hover:bg-secondary hover:border-secondary'} hover:text-white hover:shadow-lg`}
                   >
                     <span>{isRtl ? 'تواصل معنا' : 'Contact Us'}</span>
                   </a>
                </div>
              </div>

            </div>
          </div>
        );
      })}
    </div>
  </div>
</section>

<style>
  .perspective-1000 {
    perspective: 1000px;
  }
  .transform-style-3d {
    transform-style: preserve-3d;
  }
  .backface-hidden {
    backface-visibility: hidden;
  }
  .rotate-y-180 {
    transform: rotateY(180deg);
  }
  .parallax-content {
    transform: translateZ(60px);
  }
</style>