
---
import { Image } from 'astro:assets';
import type { ImageMetadata } from 'astro';

interface Props {
  images: (string | ImageMetadata)[];
  title: string;
}

const { images, title } = Astro.props;
---

<div x-data="{ open: false, activeIndex: 0 }" class="py-12">
  <h3 class="text-2xl font-bold mb-8 text-center text-white" data-aos="fade-up">{title}</h3>
  
  <!-- Image Grid -->
  <div class="grid grid-cols-2 md:grid-cols-4 gap-4" data-aos="fade-up" data-aos-delay="100">
    {images.map((img, index) => (
      <button 
        @click={`open = true; activeIndex = ${index}`}
        class="relative group overflow-hidden rounded-xl aspect-square w-full cursor-pointer focus:outline-none focus:ring-2 focus:ring-primary"
        aria-label={`View image ${index + 1}`}
      >
        {typeof img === 'string' ? (
          <img 
            src={img} 
            alt={`Gallery image ${index + 1}`}
            class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-110"
          />
        ) : (
          <Image 
            src={img} 
            alt={`Gallery image ${index + 1}`}
            class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-110"
            widths={[240, 540, 720]}
            sizes="(max-width: 768px) 50vw, 25vw"
          />
        )}
        <div class="absolute inset-0 bg-black/0 group-hover:bg-black/20 transition-colors duration-300">
          <div class="absolute inset-0 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity duration-300">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-white drop-shadow-lg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0zM10 7v3m0 0v3m0-3h3m-3 0H7" />
            </svg>
          </div>
        </div>
      </button>
    ))}
  </div>

  <!-- Lightbox Modal -->
  <div 
    x-show="open" 
    x-transition.opacity
    class="fixed inset-0 z-[300] bg-black/90 backdrop-blur-sm flex items-center justify-center p-4"
    @keydown.escape.window="open = false"
    style="display: none;"
  >
    <!-- Close Button -->
    <button 
      @click="open = false" 
      class="absolute top-4 right-4 text-white hover:text-gray-300 z-[310] focus:outline-none"
    >
      <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
      </svg>
    </button>

    <!-- Main Image Display -->
    <div class="relative w-full max-w-5xl h-full max-h-[80vh] flex items-center justify-center">
      
      <!-- Alpine-based simple slider -->
        {images.map((img, index) => (
          <div x-show={`activeIndex === ${index}`} class="w-full h-full flex items-center justify-center" x-transition.opacity>
             {typeof img === 'string' ? (
               <img 
                  src={img} 
                  alt={`Gallery full image ${index + 1}`}
                  class="max-w-full max-h-full object-contain rounded-lg shadow-2xl"
               />
             ) : (
               <Image 
                  src={img} 
                  alt={`Gallery full image ${index + 1}`}
                  class="max-w-full max-h-full object-contain rounded-lg shadow-2xl"
               />
             )}
          </div>
        ))}
        
      <!-- Prev/Next Buttons -->
      <button 
        @click={`activeIndex = (activeIndex - 1 + ${images.length}) % ${images.length}`}
        class="absolute left-0 top-1/2 -translate-y-1/2 bg-black/50 hover:bg-black/70 text-white p-2 rounded-full m-2 transition-colors"
      >
        <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
        </svg>
      </button>
      
      <button 
        @click={`activeIndex = (activeIndex + 1) % ${images.length}`}
        class="absolute right-0 top-1/2 -translate-y-1/2 bg-black/50 hover:bg-black/70 text-white p-2 rounded-full m-2 transition-colors"
      >
         <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
        </svg>
      </button>
    </div>
    
    <!-- Thumbnails in Lightbox -->
    <div class="absolute bottom-4 left-0 right-0 flex justify-center gap-2 overflow-x-auto px-4 py-2">
       {images.map((img, index) => (
          <button 
            @click={`activeIndex = ${index}`}
            class="w-16 h-16 rounded-md overflow-hidden border-2 transition-all"
            :class={`activeIndex === ${index} ? 'border-primary scale-110' : 'border-transparent opacity-60 hover:opacity-100'`}
          >
            {typeof img === 'string' ? (
              <img 
                src={img} 
                alt={`Thumbnail ${index + 1}`}
                class="w-full h-full object-cover"
              />
            ) : (
              <Image 
                src={img} 
                alt={`Thumbnail ${index + 1}`}
                class="w-full h-full object-cover"
                width={64}
                height={64}
              />
            )}
          </button>
        ))}
    </div>
  </div>
</div>
